package tests;

import cucumber.api.java.en.Given;
import cucumber.api.java.en.Then;
import org.junit.Assert;

import java.util.List;
import java.util.Map;

public class StepsDef extends Steps {

    @Given("перейти на страницу {string}")
    public void перейти_на_страницу(String string) {
        открытьХром();
        chromeDriver.get(string);

    }

    @Then("в результатах поиска есть ссылка с названием {string}")
    public void в_результатах_поиска_есть_ссылка_с_названием(String name) {
        PageObjectGoogleWithSearch googleWithSearch = new PageObjectGoogleWithSearch(chromeDriver);
        List<Map<String,Object>> resultSearch = googleWithSearch.getCollectResults();
        if(resultSearch.stream().anyMatch(x->x.get("NAME_PAGE").toString().contains(name))){
            Assert.assertTrue(true);
        }

    }



    @Then("завершить работу")
    public void завершитьРаботу() {
        закрытьХром();
    }


    @Then("проверить курс валюты {string}")
    public void проверитьКурсВалюты(String moneyType) {
        PageObjectOpen open = new PageObjectOpen(chromeDriver);
        Assert.assertTrue(
                Double.parseDouble(
                        open.getCollectExchangeRates().stream()
                                .filter(x->x.get("Валюта обмена").contains(moneyType))
                                .findFirst()
                                .get().get("Банк покупает").replace(",",".")
                )
                        <
                        Double.parseDouble(
                                open.getCollectExchangeRates().stream()
                                        .filter(x->x.get("Валюта обмена").contains(moneyType))
                                        .findFirst()
                                        .get().get("Банк продает").replace(",",".")
                        )
        );


    }
}
